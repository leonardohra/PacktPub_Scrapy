GRANIFY_CONFIG = {
  SHOP_ID: 1318,
  cookies_domain: "packtpub.com",
  use_iframe: false,
  use_cookies: false,
  analytics_tracker: [['UA-67033221-1',true,true,true,false]],
  local_jquery: false
};
(function(){var e,t,n,r;window.GLOBAL=window,window.parent!==window&&document.getElementById("js-iframe-async")&&(window.GLOBAL=window.parent);if(((n=GLOBAL.Granify)!=null?n.enabled:void 0)!=null)window.Granify={},Granify.enabled=!1;else{GLOBAL.Granify?window.Granify=GLOBAL.Granify:(window.Granify={},GLOBAL.Granify=window.Granify),Granify.enabled=!0,Granify.stopped=!1,Granify.trackers=[],Granify.tracker_classes=[],t=!0,((r=GRANIFY_CONFIG.cookies_domain)!=null?r.trim().length:void 0)>0&&GRANIFY_CONFIG.cookies_domain!=="localhost"?Granify.cookies_domain="."+GRANIFY_CONFIG.cookies_domain.trim():Granify.cookies_domain="",Granify.use_iframe=GRANIFY_CONFIG.use_iframe;try{window.localStorage.setItem("_gr_l","1"),window.localStorage.getItem("_gr_l")||(t=!1),window.localStorage.removeItem("_gr_l")}catch(i){e=i,t=!1}Granify.localStorageWorking=t,!Granify.localStorageWorking&&!Granify.use_iframe&&(Granify.enabled=!1)}}).call(this),typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n="0.7.3",r="",i="?",s="function",o="undefined",u="object",a="major",f="model",l="name",c="type",h="vendor",p="version",d="architecture",v="console",m="mobile",g="tablet",y="smarttv",b="wearable",w="embedded",E={extend:function(e,t){for(var n in t)"browser cpu device engine os".indexOf(n)!==-1&&t[n].length%2===0&&(e[n]=t[n].concat(e[n]));return e},has:function(e,t){if(typeof e=="string")return t.toLowerCase().indexOf(e.toLowerCase())!==-1},lowerize:function(e){return e.toLowerCase()}},S={rgx:function(){var e,n=0,r,i,a,f,l,c,h=arguments;while(n<h.length&&!l){var p=h[n],d=h[n+1];if(typeof e===o){e={};for(a in d)f=d[a],typeof f===u?e[f[0]]=t:e[f]=t}r=i=0;while(r<p.length&&!l){l=p[r++].exec(this.getUA());if(!!l)for(a=0;a<d.length;a++)c=l[++i],f=d[a],typeof f===u&&f.length>0?f.length==2?typeof f[1]==s?e[f[0]]=f[1].call(this,c):e[f[0]]=f[1]:f.length==3?typeof f[1]===s&&(!f[1].exec||!f[1].test)?e[f[0]]=c?f[1].call(this,c,f[2]):t:e[f[0]]=c?c.replace(f[1],f[2]):t:f.length==4&&(e[f[0]]=c?f[3].call(this,c.replace(f[1],f[2])):t):e[f]=c?c:t}n+=2}return e},str:function(e,n){for(var r in n)if(typeof n[r]===u&&n[r].length>0){for(var s=0;s<n[r].length;s++)if(E.has(n[r][s],e))return r===i?t:r}else if(E.has(n[r],e))return r===i?t:r;return e}},x={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:"NT 6.4",RT:"ARM"}}}},T={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[l,p,a],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[l,"Opera"],p,a],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[l,p,a],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[l,"IE"],p,a],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[l,"Yandex"],p,a],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[l,/_/g," "],p,a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i],[l,p,a],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[l,"Dolphin"],p,a],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[l,"Chrome"],p,a],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[p,a,[l,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[p,a,l],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[l,[a,S.str,x.browser.oldsafari.major],[p,S.str,x.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[l,p,a],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[l,"Netscape"],p,a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[l,p,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[d,"amd64"]],[/(ia32(?=;))/i],[[d,E.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[d,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[d,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[d,/ower/,"",E.lowerize]],[/(sun4\w)[;\)]/i],[[d,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[d,E.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[f,h,[c,g]],[/applecoremedia\/[\w\.]+ \((ipad)/],[f,[h,"Apple"],[c,g]],[/(apple\s{0,1}tv)/i],[[f,"Apple TV"],[h,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[h,f,[c,g]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[f,[h,"Amazon"],[c,g]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[f,S.str,x.device.amazon.model],[h,"Amazon"],[c,m]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[f,h,[c,m]],[/\((ip[honed|\s\w*]+);/i],[f,[h,"Apple"],[c,m]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[h,f,[c,m]],[/\(bb10;\s(\w+)/i],[f,[h,"BlackBerry"],[c,m]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[f,[h,"Asus"],[c,g]],[/(sony)\s(tablet\s[ps])/i],[h,f,[c,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[h,f,[c,v]],[/android.+;\s(shield)\sbuild/i],[f,[h,"Nvidia"],[c,v]],[/(playstation\s[3portablevi]+)/i],[f,[h,"Sony"],[c,v]],[/(sprint\s(\w+))/i],[[h,S.str,x.device.sprint.vendor],[f,S.str,x.device.sprint.model],[c,m]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[h,f,[c,g]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[h,[f,/_/g," "],[c,m]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[f,[h,"Microsoft"],[c,v]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[h,"Microsoft"],[c,m]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[h,"Motorola"],f,[c,m]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[f,[h,"Motorola"],[c,g]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[h,"Samsung"],f,[c,g]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[h,"Samsung"],f,[c,m]],[/(samsung);smarttv/i],[h,f,[c,y]],[/\(dtv[\);].+(aquos)/i],[f,[h,"Sharp"],[c,y]],[/sie-(\w+)*/i],[f,[h,"Siemens"],[c,m]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[h,"Nokia"],f,[c,m]],[/android\s3\.[\s\w-;]{10}(a\d{3})/i],[f,[h,"Acer"],[c,g]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[h,"LG"],f,[c,g]],[/(lg) netcast\.tv/i],[h,f,[c,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[f,[h,"LG"],[c,m]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[f,[h,"Lenovo"],[c,g]],[/linux;.+((jolla));/i],[h,f,[c,m]],[/((pebble))app\/[\d\.]+\s/i],[h,f,[c,b]],[/android.+;\s(glass)\s\d/i],[f,[h,"Google"],[c,b]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[c,E.lowerize],h,f]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[l,p],[/rv\:([\w\.]+).*(gecko)/i],[p,l]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[l,p],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[l,[p,S.str,x.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[l,"Windows"],[p,S.str,x.os.windows.version]],[/\((bb)(10);/i],[[l,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[l,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[l,"Symbian"],p],[/\((series40);/i],[l],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[l,"Firefox OS"],p],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[l,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[l,"Chromium OS"],p],[/(sunos)\s?([\w\.]+\d)*/i],[[l,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[l,p],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[l,"iOS"],[p,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[l,"Mac OS"],[p,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[l,p]]},N=function(t,n){if(!(this instanceof N))return(new N(t,n)).getResult();var i=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:r),s=n?E.extend(T,n):T;this.getBrowser=function(){return S.rgx.apply(this,s.browser)},this.getCPU=function(){return S.rgx.apply(this,s.cpu)},this.getDevice=function(){return S.rgx.apply(this,s.device)},this.getEngine=function(){return S.rgx.apply(this,s.engine)},this.getOS=function(){return S.rgx.apply(this,s.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this.setUA(i)};N.VERSION=n,N.BROWSER={NAME:l,MAJOR:a,VERSION:p},N.CPU={ARCHITECTURE:d},N.DEVICE={MODEL:f,VENDOR:h,TYPE:c,CONSOLE:v,MOBILE:m,SMARTTV:y,TABLET:g,WEARABLE:b,EMBEDDED:w},N.ENGINE={NAME:l,VERSION:p},N.OS={NAME:l,VERSION:p},this.ua=(new N).getResult()}.call(Granify,window),function(){Granify.enabled&&(Granify.SHOP_ID=GRANIFY_CONFIG.SHOP_ID,Granify.use_local_jquery=GRANIFY_CONFIG.local_jquery,Granify.rb=function(){return this},Granify.rb.server_ga_stores=[],Granify.rb.matching_host="//matching.granify.com",Granify.rb.asset_host="//cdn.granify.com",Granify.rb.env="production",Granify.domain=Granify.rb.asset_host,Granify.rb.version={rb:"2016-12-20 22:48:55 +0000",js:168},Granify.rb.environment=function(e){return"production"===e},Granify.rb.get_analytics=function(){return Granify.analyticsID=GRANIFY_CONFIG.analytics_tracker})}.call(this),function(){Granify.enabled&&(Date.prototype.addHours=function(e){return this.setTime(this.getTime()+e*60*60*1e3),this},Date.prototype.addSeconds=function(e){return this.setTime(this.getTime()+e*1e3),this},Granify.getFormattedDate=function(){var e;return e=new Date,e.getUTCFullYear()+"-"+("00"+(e.getUTCMonth()+1)).slice(-2)+"-"+("00"+e.getUTCDate()).slice(-2)+" "+("00"+e.getUTCHours()).slice(-2)+":"+("00"+e.getUTCMinutes()).slice(-2)+":"+("00"+e.getUTCSeconds()).slice(-2)},Granify.getExpiresDateByYear=function(e){var t;return t=new Date,t.setFullYear(e),t},Granify.getTimezone=function(){return-((new Date).getTimezoneOffset()/60)})}.call(this),function(){Granify.enabled&&(Granify.F_NEW_SESSION=1,Granify.F_TEST_GROUP=2,Granify.F_RANDOM_SAMPLING=4,Granify.F_IS_NEW_USER=8,Granify.F_IS_RETURNED_USER=16,Granify.F_IS_RETURNED_BUYER=32,Granify.F_CG=64,Granify.F_FLAGS_INITIALIZED=128,Granify.F_CG_INITIALIZED=256,Granify.session_expiration_delta=GLOBAL._test_session_expiration_delta||1800,Granify.flags_expiration_delta=GLOBAL._test_flags_expiration_delta||43200,Granify.session_expiration=function(){return+(new Date).addSeconds(Granify.session_expiration_delta)},Granify.flags_expiration=function(){return+(new Date).addSeconds(Granify.flags_expiration_delta)},Granify.getStorageName=function(e){return Granify.isFunction(e.name)?e.name():e.name},Granify.getStorageExpiration=function(e){return Granify.isFunction(e.expires)?e.expires():e.expires},Granify.storage={MUTEX:{name:"mutex",expires:function(){return+(new Date).addSeconds(5)}},UUID:{name:"uuid"},THROW_ERRORS:{name:"throw_granify_errors"},BOOKMARKLET:{name:"granify_bookmarklet"},ENTRY_PAGE:{name:"entry_page"},ENTRY_PAGE_SENT:{name:"entry_page_sent"},ENTRY_REFERRER:{name:"entry_referrer"},ENTRY_REFERRER_SENT:{name:"entry_referrer_sent"},UNCONFIRMED_ORDERS:{name:"unconfirmed_orders"},LAST_SERVER_TIME:{name:"last_server_time"},CHECK_IFRAME_COOKIES:{name:function(){return"check_cookies_"+Granify.start_time_fixed},expires:function(){return+(new Date).addSeconds(1)}},SESSION_INITIALIZED:{name:"session_init"},SESSION:{name:"session"},FLAGS:{name:"flags",expires:Granify.flags_expiration},LAST_SESSION:{name:"last_session"},HAS_ORDERS:{name:"has_orders"},LAST_ORDER:{name:"last_order"},LAST_FAST_ORDER:{name:"last_fast_order"},LAST_GA_FAST_ORDER:{name:"last_ga_fast_order"},GA_GROUP:{name:function(){return"ga_group:"+Granify.SHOP_ID},expires:function(){return+(new Date).addHours(.166)}},GA_CONTROL_GROUP:{name:function(){return"ga_cgroup:"+Granify.SHOP_ID},expires:function(){return+(new Date).addHours(.166)}}})}.call(this),function(){var e,t,n,r,i;window.is_ie8=!1,Granify.is_ie=!1,r=window.navigator.userAgent,e=r.indexOf("MSIE "),n=r.indexOf("Trident/");if(e>0||n>0)Granify.is_ie=!0,e>0?i=parseInt(r.substring(e+5,r.indexOf(".",e)),10):n>0&&(t=r.indexOf("rv:"),i=parseInt(r.substring(t+3,r.indexOf(".",t)),10)),i===8&&(window.is_ie8=!0),i<9&&(Granify.enabled=!1)}.call(this),function(){window.addGranifyListener=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!0):e.attachEvent("on"+t,n)},window.removeGranifyListener=function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!0):e.detachEvent("on"+t,n)}}.call(this),function(){Granify.enabled&&(Granify.showDebug=function(e){var t,n,r,i,s,o,u;t=GLOBAL.document.getElementById("granify_debug"),t||(Granify.addStyleRules("#granify_debug{position:absolute;z-index:999999;top:0;left:0;width:800px;padding:10px;height:auto;border:1px solid red;background:rgba(0,0,0,.9);.log{border-bottom:1px solid #ccc;margin-bottom:10px;white-space:normal;&.info{color:lighten(#0F0,40%)}&.warn{color:lighten(#FF7F00,20%)}&.debug{color:#fff}&.error{color:lighten(#F00,40%)}.separator{height:5px;background-color:#fff;margin-bottom:10px}"),t=GLOBAL.document.createElement("div"),t.id="granify_debug",GLOBAL.document.body.appendChild(t)),i=GLOBAL.document.createElement("div"),i.className="separator",t.appendChild(i);if(e.logs){u=e.logs;for(s=0,o=u.length;s<o;s++)r=u[s],n=GLOBAL.document.createElement("div"),n.className="log "+r[0],n.innerHTML=r[0]+": "+r[1],t.appendChild(n)}if(e.error)return n=GLOBAL.document.createElement("div"),n.className="log error",n.innerHTML=e.error+"<br/>"+e.backtrace.join("<br/>"),t.appendChild(n)},Granify.testDebug=function(e){if(GLOBAL.$!=null&&Granify.test_mode)return GLOBAL.$("#test-errors").prepend(e+"<br>")})}.call(this),function(){"use strict";function e(e){return typeof e=="function"||typeof e=="object"&&e!==null}function t(e){return typeof e=="function"}function n(e){return typeof e=="object"&&e!==null}function f(e){u=e}function l(e){a=e}function m(){return function(){process.nextTick(S)}}function g(){return function(){o(S)}}function y(){var e=0,t=new p(S),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function b(){var e=new MessageChannel;return e.port1.onmessage=S,function(){e.port2.postMessage(0)}}function w(){return function(){setTimeout(S,1)}}function S(){for(var e=0;e<s;e+=2){var t=E[e],n=E[e+1];t(n),E[e]=undefined,E[e+1]=undefined}s=0}function x(){try{var e=require,t=e("vertx");return o=t.runOnLoop||t.runOnContext,g()}catch(n){return w()}}function N(e,t){var n=this,r=new this.constructor(O);r[A]===undefined&&tt(r);var i=n._state;if(i){var s=arguments[i-1];a(function(){G(i,r,s,n._result)})}else V(n,r,e,t);return r}function k(e){var t=this;if(e&&typeof e=="object"&&e.constructor===t)return e;var n=new t(O);return U(n,e),n}function O(){}function H(){return new TypeError("You cannot resolve a promise with itself")}function B(){return new TypeError("A promises callback cannot return that same promise.")}function j(e){try{return e.then}catch(t){return P.error=t,P}}function F(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function I(e,t,n){a(function(e){var r=!1,i=F(n,t,function(n){if(r)return;r=!0,t!==n?U(e,n):W(e,n)},function(t){if(r)return;r=!0,X(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,X(e,i))},e)}function q(e,t){t._state===_?W(e,t._result):t._state===D?X(e,t._result):V(t,undefined,function(t){U(e,t)},function(t){X(e,t)})}function R(e,n,r){n.constructor===e.constructor&&r===C&&constructor.resolve===L?q(e,n):r===P?X(e,P.error):r===undefined?W(e,n):t(r)?I(e,n,r):W(e,n)}function U(t,n){t===n?X(t,H()):e(n)?R(t,n,j(n)):W(t,n)}function z(e){e._onerror&&e._onerror(e._result),$(e)}function W(e,t){if(e._state!==M)return;e._result=t,e._state=_,e._subscribers.length!==0&&a($,e)}function X(e,t){if(e._state!==M)return;e._state=D,e._result=t,a(z,e)}function V(e,t,n,r){var i=e._subscribers,s=i.length;e._onerror=null,i[s]=t,i[s+_]=n,i[s+D]=r,s===0&&e._state&&a($,e)}function $(e){var t=e._subscribers,n=e._state;if(t.length===0)return;var r,i,s=e._result;for(var o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?G(n,r,i,s):i(s);e._subscribers.length=0}function J(){this.error=null}function Q(e,t){try{return e(t)}catch(n){return K.error=n,K}}function G(e,n,r,i){var s=t(r),o,u,a,f;if(s){o=Q(r,i),o===K?(f=!0,u=o.error,o=null):a=!0;if(n===o){X(n,B());return}}else o=i,a=!0;n._state===M&&(s&&a?U(n,o):f?X(n,u):e===_?W(n,o):e===D&&X(n,o))}function Y(e,t){try{t(function(n){U(e,n)},function(n){X(e,n)})}catch(n){X(e,n)}}function et(){return Z++}function tt(e){e[A]=Z++,e._state=undefined,e._result=undefined,e._subscribers=[]}function nt(e){return(new ht(this,e)).promise}function it(e){var t=this;return i(e)?new t(function(n,r){var i=e.length;for(var s=0;s<i;s++)t.resolve(e[s]).then(n,r)}):new t(function(e,t){t(new TypeError("You must pass an array to race."))})}function ot(e){var t=this,n=new t(O);return X(n,e),n}function at(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ft(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function ct(e){this[A]=et(),this._result=this._state=undefined,this._subscribers=[],O!==e&&(typeof e!="function"&&at(),this instanceof ct?Y(this,e):ft())}function pt(e,t){this._instanceConstructor=e,this.promise=new e(O),this.promise[A]||tt(this.promise),i(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),this.length===0?W(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&W(this.promise,this._result))):X(this.promise,dt())}function dt(){return new Error("Array Methods must be provided an Array")}var r;Array.isArray?r=Array.isArray:r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=r,s=0,o,u,a=function(t,n){E[s]=t,E[s+1]=n,s+=2,s===2&&(u?u(S):T())},c=typeof window!="undefined"?window:undefined,h=c||{},p=h.MutationObserver||h.WebKitMutationObserver,d=typeof self=="undefined"&&typeof process!="undefined"&&{}.toString.call(process)==="[object process]",v=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",E=new Array(1e3),T;d?T=m():p?T=y():v?T=b():c===undefined&&typeof require=="function"?T=x():T=w();var C=N,L=k,A=Math.random().toString(36).substring(16),M=void 0,_=1,D=2,P=new J,K=new J,Z=0,rt=nt,st=it,ut=ot,lt=ct;ct.all=rt,ct.race=st,ct.resolve=L,ct.reject=ut,ct._setScheduler=f,ct._setAsap=l,ct._asap=a,ct.prototype={constructor:ct,then:C,"catch":function(e){return this.then(null,e)}};var ht=pt;pt.prototype._enumerate=function(){var e=this.length,t=this._input;for(var n=0;this._state===M&&n<e;n++)this._eachEntry(t[n],n)},pt.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===L){var i=j(e);if(i===C&&e._state!==M)this._settledAt(e._state,t,e._result);else if(typeof i!="function")this._remaining--,this._result[t]=e;else if(n===lt){var s=new n(O);R(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){t(e)}),t)}else this._willSettleAt(r(e),t)},pt.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===M&&(this._remaining--,e===D?X(r,n):this._result[t]=n),this._remaining===0&&W(r,this._result)},pt.prototype._willSettleAt=function(e,t){var n=this;V(e,undefined,function(e){n._settledAt(_,t,e)},function(e){n._settledAt(D,t,e)})};var vt=function(e){return function(){var t;if(typeof global!="undefined")t=global;else if(typeof self!="undefined")t=self;else try{t=Function("return this")()}catch(n){throw new Error("polyfill of Granify promise failed because global object is unavailable in this environment")}var r=t.Promise;if(r&&Object.prototype.toString.call(r.resolve())==="[object Promise]"&&!r.cast){typeof e!="undefined"&&(e.Promise=r);return}typeof e!="undefined"&&(e.Promise=lt)}}(this),mt=vt;lt.Promise=lt,lt.polyfill=mt,typeof this!="undefined"&&(this.Promise=lt),mt()}.call(Granify),function(){Granify.enabled&&(Granify.iframeCallbacks={},Granify.setIframeData=function(e,t,n,r){return n==null&&(n=0),r==null&&(r="set"),Granify.isDate(n)&&(n=+n),Granify.execAfterFrameLoaded(function(){return typeof t=="object"&&(t=JSON.stringify(t)),Granify.frame.contentWindow.postMessage(""+r+":"+e+"="+t+"@"+n,"*")})},Granify.getToggle=function(e,t){return Granify.getIframeData(e,t,"get-toggle")},Granify.setToggle=function(e,t){return Granify.setIframeData(e,t,0,"set-toggle")},Granify.setSharedData=function(e,t,n){var r;n==null&&(n=0),Granify.isObject(e)&&(n||(n=Granify.getStorageExpiration(e)),e=Granify.getStorageName(e));if(Granify.use_iframe)return Granify.setIframeData(Granify.keyname(e),t,n);try{return n===0&&(n=null),Granify.setStorage(Granify.keyname(e,!0),t,n)}catch(i){return r=i,Granify.log_error("Can't persist "+e+" with value "+t)}},Granify.getIframeData=function(e,t,n){var r;return n==null&&(n="get"),(r=Granify.iframeCallbacks)[e]==null&&(r[e]=[]),Granify.iframeCallbacks[e].push(t),Granify.execAfterFrameLoaded(function(){return Granify.frame.contentWindow.postMessage(""+n+":"+e,"*")})},Granify.getSharedData=function(e,t){var n;return t==null&&(t=null),Granify.isObject(e)&&(e=Granify.getStorageName(e)),t?Granify.use_iframe?Granify.getIframeData(Granify.keyname(e),t):t(Granify.getStorage(Granify.keyname(e))):(n=new Granify.Promise(function(t){return Granify.use_iframe?Granify.getIframeData(Granify.keyname(e),t):t(Granify.getStorage(Granify.keyname(e)))}),n)},Granify.eraseIframeData=function(e,t){return t==null&&(t="erase"),Granify.execAfterFrameLoaded(function(){return Granify.frame.contentWindow.postMessage(""+t+":"+e,"*")})},Granify.eraseSharedData=function(e){return Granify.isObject(e)&&(e=Granify.getStorageName(e)),Granify.use_iframe?Granify.eraseIframeData(Granify.keyname(e)):Granify.eraseStorage(Granify.keyname(e))},Granify.messageDispatcher=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;if(!e.origin.match(/granify/)&&!e.origin.match(/localhost|localdocker/))return;r=e.data,Object.prototype.toString.call(r)==="[object String]"&&(a=r.match(/([\.\w]+):(.*)/));if(a){o=a[1],f=a[2];try{s=JSON.parse(f),s?f=s.data:f=null}catch(p){i=p}u=o.replace("."+Granify.SHOP_ID,""),f==="undefined"&&(f=Granify.getStorage(u)),u==="uuid"&&(n=Granify.getStorage(u),Granify.isString(n)&&n.length>0&&n!==f&&(f=n)),u==="granify.widget_state"&&typeof f=="object"&&(f=JSON.stringify(f));if(Granify.iframeCallbacks[o]){h=Granify.iframeCallbacks[o];for(l=0,c=h.length;l<c;l++){t=h[l];try{t&&t(f)}catch(p){i=p,Granify.error(i,"messageDispatch")}}return delete Granify.iframeCallbacks[o]}}},addGranifyListener(window,"message",Granify.messageDispatcher))}.call(this),function(){Granify.isObject=function(e){return Object.prototype.toString.call(e)==="[object Object]"},Granify.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},Granify.isBoolean=function(e){return e===!0||e===!1||Object.prototype.toString.call(e)==="[object Boolean]"},Granify.isNumber=function(e){return Object.prototype.toString.call(e)==="[object Number]"},Granify.isInteger=function(e){return Object.prototype.toString.call(e)==="[object Number]"&&isFinite(e)&&Math.floor(e)===e},Granify.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},Granify.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},Granify.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"},Granify.isPromise=function(e){return Object.prototype.toString.call(e)==="[object Promise]"}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.compact_object=function(e){var t,n,r,i,s,o,u,a;Granify.isArray(e)?r=[]:r={};if(typeof e=="object"){e=Granify.packObj(e);for(s in e){o=e[s];if(typeof o=="number"&&o!==0||typeof o=="string"&&o.length!==0)r[s]=o;else if(Granify.isArray(o)){t=[];for(u=0,a=o.length;u<a;u++)i=o[u],n=Granify.compact_object(i),n!=null&&t.push(n);t.length>0&&(r[s]=t)}else typeof o=="object"&&o!=null&&(n=Granify.compact_object(o),n!=null&&JSON.stringify(n)!=="{}"&&(r[s]=n))}}return r},Granify.reduce_precision=function(e){var t,n,r;t={};for(n in e)r=e[n],t[n]={d:Granify.round(r.d),t:Granify.round(r.t),s:Granify.round(r.s),a:Granify.round(r.a),c:Granify.round(r.c)},r.e!=null&&(t[n].e=r.e);return t},Granify.reduce_ms_precision=function(e){var t,n,r,i,s;Granify.isArray(e)?t=[]:t={};for(n in e){i=e[n];if(typeof i=="object"&&!Granify.isArray(i)){t[n]={};for(r in i)s=i[r],isNaN(s)&&(s=0),t[n][r]=parseFloat(Granify.round(s))}else t[n]=i}return t},Granify.data_aliases={id:"i",session:"s",class_name:"cn",uuid:"id",site_id:"sid",cart_contents:"cc",start_time:"st",visit_duration:"vd",status:"sts",page_type:"pt",mouse_distance:"md",scroll_distance:"sd",scroll_depth:"sh",tab_changes:"tc",mouse_heatmap:"mh",mouse_stats:"ms",timezone:"tz",source:"src",referer:"ref",service:"srv",query:"qry",current_time:"ct",medium:"me",content:"co",campaign:"ca",term:"te",over:"ov",text:"tx",links:"lk",images:"im",other:"oh",time:"tm",buttons:"bu",selections:"sel",click:"cl",copied_text:"cx",orig_length:"ol",path:"p",scroll_top:"sc",viewport:"v",tags:"t",category:"cat",subcategory:"scat",data:"dt",flags:"f",name:"n",price:"pr",widget_latency_full:"wlf",widget_latency_js:"wlj",entry_page:"ep",entry_referrer:"er",has_unconfirmed_orders:"uo",mouse_active_time:"ma",time_since_start:"tss",time_since_dom:"tsd"},Granify.packObj=function(t){var n,r,i,s;Granify.isArray(t)?r=[]:r={};for(n in t){i=t[n],s=["flags","timezone","items"];if((i==null||i===""||i===0||i.length===0||i==="{}")&&e.call(s,n)<0)continue;Granify.data_aliases[n]!=null?Granify.isNumber(i)?r[Granify.data_aliases[n]]=Granify.round(i):Granify.isObject(i)?r[Granify.data_aliases[n]]=Granify.packObj(i):r[Granify.data_aliases[n]]=i:r[n]=i}return r},Granify.removeUnchangedData=function(t){var n,r,i;if(Granify.latestSentData){r=["uuid","session","site_id","start_time","visit_duration","tags","flags","x","current_time","has_unconfirmed_orders"],i={};for(n in t)e.call(r,n)<0&&Granify.latestSentData[n]===t[n]||(i[n]=t[n]);return i}return t}}.call(this),function(){typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Granify.strDiff=function(e,t){return e.length>t.length?e.replace(t,""):t.replace(e,"")},Granify.isLocationChanged=function(e){var t;return t=Granify.strDiff(e,GLOBAL.location.href),t!==""&&t!=="#"&&t!=="#."}}.call(this),function(){Granify.roundProperty=function(e,t){if(e)return e[t]=Granify.round(e[t])},Granify.round=function(e){var t;return t=e||0,Granify.isNumber(e)&&(t=parseFloat(Granify.roundOnePlace(e))),t},Granify.isRounded=function(e){return Granify.isNumber(e)?10*e-parseInt(10*e)===0:!1},Granify.roundAllProperties=function(e){var t,n,r;e==null&&(e=Granify),r=[];for(t in e)n=e[t],Granify.isNumber(n)?Granify.isRounded(n)?r.push(void 0):r.push(Granify.roundProperty(n)):Granify.isObject(n)?r.push(Granify.roundAllProperties(n)):r.push(void 0);return r},Granify.roundOnePlace=function(e){return Math.round(e*10)/10}}.call(this),function(){Granify.enabled&&(Granify.throttle=function(e,t,n){var r,i,s,o,u,a;return i=r=u=a=null,o=0,n||(n={}),s=function(){var t;return o=(t=n.leading===false)!=null?t:{0:new Date},a=null,u=e.apply(i,r)},function(){var f,l;return f=new Date,!o&&n.leading===!1&&(o=f),l=t-(f-o),i=this,r=arguments,l<=0?(clearTimeout(a),a=null,o=f,u=e.apply(i,r)):!a&&n.trailing!==!1&&(a=setTimeout(s,l)),u}})}.call(this),function(){Granify.enabled&&(Granify.getDocumentHeight=function(){var e;return e=GLOBAL.document,Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.body.clientHeight,e.documentElement.clientHeight)},Granify.getDocumentWidth=function(){var e,t;return(typeof GLOBAL!=="undefined"&&GLOBAL!==null?(t=GLOBAL.document)!=null?t.body:void 0:void 0)==null?0:(e=GLOBAL.document,Math.max(e.body.scrollWidth,e.documentElement
.scrollWidth,e.body.offsetWidth,e.documentElement.offsetWidth,e.body.clientWidth,e.documentElement.clientWidth))},Granify.ValidIpAddressRegex=/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/,Granify.forceSecureProtocol=function(e){return e||Granify.log_error("Granify.forceSecureProtocol was passed an invalid value, url is undefined"),e.match(/localhost|localdocker/)||e.match(Granify.ValidIpAddressRegex)?e:e.indexOf("//")===0?"https:"+e:e.replace("http://","https://")},Granify.insertFrame=function(){var e;return e=document.getElementsByTagName("body")[0],e?(Granify.frame=document.createElement("iframe"),Granify.frame.src=Granify.forceSecureProtocol(Granify.domain)+("/identifier.html?matching="+Granify.matching),Granify.frame.style.display="none",Granify.frame.title="Granify identifier",addGranifyListener(Granify.frame,"load",function(){return Granify.frameLoaded=!0}),e.appendChild(Granify.frame)):setTimeout(Granify.insertFrame,100)},Granify.insertStylesheet=function(e,t,n){var r;return t==null&&(t=""),n==null&&(n=function(){}),r=GLOBAL.document.createElement("link"),r.rel="stylesheet",r.type="text/css",r.className=t,r.href=e,r.onload=n,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(r)},Granify.addStyleRules=function(e,t){var n;return t==null&&(t="granify-style-sheet"),n=document.createElement("style"),n.className=t,n.type="text/css",is_ie8?n.styleSheet.cssText=e:n.innerHTML=e,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(n)},Granify.insertScript=function(e,t,n){var r;return t==null&&(t=function(){}),n==null&&(n=null),r=GLOBAL.document.createElement("script"),r.src=e,n&&(r.id=n),r.readyState?r.onreadystatechange=function(){if(r.readyState==="loaded"||r.readyState==="complete")return r.onreadystatechange=function(){},t()}:r.onload=function(){return t()},GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(r)},Granify.execAfterDOMAvailable=function(e){return GLOBAL.document.readyState==="complete"||!is_ie8&&document.readyState==="interactive"?setTimeout(function(){return e.call(this)},0):setTimeout(function(){return Granify.execAfterDOMAvailable(e)},100)},Granify.execAfterDOMLoaded=function(e){return GLOBAL.document.readyState==="complete"?setTimeout(function(){return e.call(this)},0):setTimeout(function(){return Granify.execAfterDOMLoaded(e)},100)},Granify.execAfterFrameLoaded=function(e){return Granify.frameLoaded||!Granify.use_iframe?e.call(this):setTimeout(function(){return Granify.execAfterFrameLoaded(e)},100)},Granify.createXPathFromElement=function(e){var t,n,r;n=[];while(e&&e.nodeType===1){if(typeof e.hasAttribute=="function"?e.hasAttribute("id"):void 0)n.unshift("id("+e.getAttribute("id")+")");else if(typeof e.hasAttribute=="function"?e.hasAttribute("class"):void 0)n.unshift(e.nodeName.toLowerCase()+"[@class="+e.getAttribute("class")+"]");else{r=e.previousSibling,t=1;while(r)r.nodeName===e.nodeName&&t++,r=r.previousSibling;n.unshift(e.nodeName.toLowerCase()+"["+t+"]")}e=e.parentNode}return n.length?"/"+n.join("/"):null})}.call(this),function(){var e={}.hasOwnProperty;Granify.enabled&&(Granify.hashToQuery=function(t){var n,r,i;r=[];for(n in t){if(!e.call(t,n))continue;i=t[n],i!==void 0&&r.push(""+n+"="+encodeURIComponent(i))}return r.join("&")},Granify.JSONP=function(e,t,n,r){var i,s;return t==null&&(t={}),r==null&&(r=!0),i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("script"),r&&(s.async="async"),s.charset="UTF-8",t.callback="granify_cb_"+ +(new Date),window[t.callback]=n,s.src=e+"?"+Granify.hashToQuery(t),s.onload=function(){return i.removeChild(s)},i.insertBefore(s,i.firstChild)},Granify.AJAX=function(e,t,n){var r;return t==null&&(t={}),n==null&&(n=function(){}),r=new XMLHttpRequest,e=e+"?"+Granify.hashToQuery(t),r.onreadystatechange=function(){var e;if(r.readyState===4&&r.status===200)return e=(new Function("return "+r.responseText))(),n(e)},r.open("GET",e,!0),r.send()},Granify.POST=function(e,t,n,r){var i,s,o;t==null&&(t={}),n==null&&(n=function(){}),r==null&&(r=function(){});try{return s=JSON.stringify(t),o=new XMLHttpRequest,o.onreadystatechange=function(){var e;if(o.readyState===4)return o.status===200?(e=(new Function("return "+o.responseText))(),n(e)):r()},o.open("POST",e,!0),o.setRequestHeader("Content-type","text/plain"),o.send(s)}catch(u){return i=u,Granify.error(i,"POST"),r()}})}.call(this),function(){var e={}.hasOwnProperty;Granify.enabled&&(Granify.not_synced_errors=[],Granify.last_error_sync=null,Granify.error=function(e,t){var n,r,i;n={name:""+t+"-"+e.name+"-"+Granify.ua.browser.name+"-"+Granify.version.js,message:e.message,version:Granify.version.rb,stack:(r=e.stack)!=null?r.toString():void 0,column:e.columnNumber,site_id:Granify.SHOP_ID,UUID:Granify.UUID,session:Granify.SESSION,context_data:e.context_data,env:Granify.rb.env},(i=window.console)!=null&&typeof i.log=="function"&&i.log("Granify.error: ",n.name,n.message),Granify.not_synced_errors.push(n),Granify.errors.push(""+n.name+" - "+n.message),Granify.test_mode&&GLOBAL.$!=null&&GLOBAL.$("#test-errors").empty().append("ERROR: "+JSON.stringify(n));if(Granify.throw_errors)throw e;return Granify.syncErrors()},Granify.syncErrors=function(){var e;if(Granify.not_synced_errors.length===0)return;if(new Date-Granify.last_error_sync<1e3)return;return Granify.last_error_sync=new Date,Granify.not_synced_errors.length>5&&(e=Granify.not_synced_errors.length,Granify.not_synced_errors=Granify.not_synced_errors.slice(0,5),Granify.log_error("More then 5 errors per second",{errors_count:e})),Granify.POST(""+Granify.matching+"/error",{errors:JSON.stringify(Granify.not_synced_errors)}),Granify.not_synced_errors=[],setTimeout(function(){return Granify.syncErrors()},1e3)},Granify.log_error=function(e,t){var n;t==null&&(t={});if(!Granify.send_validation_errors)return;Granify.test_mode&&GLOBAL.$!=null&&GLOBAL.$("#test-errors").empty().append("ERROR: "+JSON.stringify(t));try{throw typeof console!="undefined"&&console!==null&&console.log("Granify.com error: "+e,t),new Error}catch(r){return n=r,n.name=e,t&&(n.message=typeof JSON!="undefined"&&JSON!==null?JSON.stringify(t):void 0),Granify.error(n,"log_error")}},Granify.testsDebug=function(e){if(Granify.testsDebugMessages!=null)return Granify.testsDebugMessages.push(e)},Granify.addErrorHandling=function(t){var n,r,i;i=[];for(r in t){if(!e.call(t,r))continue;n=t[r],typeof n=="function"&&r!=="rb"&&r!=="error"&&r!=="addErrorHandling"&&r!=="uuid"&&r!=="Promise"?i.push(t[r]=function(e,n){return function(){var r;try{return n.apply(t,arguments)}catch(i){return r=i,Granify.error(r,""+e)}}}(r,n)):i.push(void 0)}return i})}.call(this),function(){Granify.enabled&&(Granify.getCookie=function(e,t){return t==null&&(t=!1),Granify.getSharedData(e)},Granify.setCookie=function(e,t,n){return Granify.setSharedData(e,t,n)},Granify.eraseCookie=function(e){return Granify.eraseSharedData(e)})}.call(this),function(){Granify.enabled&&(Granify.getStorage=function(e){var t,n,r,i;if(!Granify.localStorageWorking)return;Granify.isObject(e)&&(e=Granify.getStorageName(e)),i=null;try{i=window.localStorage.getItem(e),r=JSON.parse(i),r&&(r.expires!=null?(n=r.expires,parseInt(n)>+(new Date)?i=r.data:(i=null,Granify.eraseStorage(e))):i=r)}catch(s){t=s,t instanceof SyntaxError?Granify.log_error("Error parsing local storage value into JSON",{key:e,value:i,clientDate:new Date,location:location.toString(),exceptionMsg:t.message}):Granify.log_error("Error reading value from local storage",{key:e,clientDate:new Date,location:location.toString(),exceptionMsg:t.message})}return i},Granify.setStorage=function(e,t,n){var r,i;if(!Granify.localStorageWorking)return;Granify.isObject(e)&&(n||(n=Granify.getStorageExpiration(e)),e=Granify.getStorageName(e)),n==null&&(n=new Date("2020/01/01 00:00:00"));try{return r=JSON.stringify({expires:+n,data:t}),window.localStorage.setItem(e,r)}catch(s){return i=s,Granify.log_error("Error writing value to local storage",{key:e,writeValue:r,clientDate:new Date,location:location.toString(),exceptionMsg:i.message})}},Granify.eraseStorage=function(e){var t;if(!Granify.localStorageWorking)return;try{return Granify.isObject(e)&&(e=Granify.getStorageName(e)),window.localStorage.removeItem(e)}catch(n){return t=n,Granify.log_error("Error deleting value from local storage",{key:e,clientDate:new Date,location:location.toString(),exceptionMsg:t.message})}})}.call(this),function(){Granify.enabled&&(Granify.events==null&&(Granify.events={}),Granify.trigger=function(e){var t;return(t=Granify.events)[e]==null&&(t[e]={}),Granify.events[e].triggered=!0,Granify.triggerEventCallbacks(e)},Granify.triggerEventCallbacks=function(e){var t,n,r,i;if(!(typeof Granify!="undefined"&&Granify!==null?(i=Granify.events[e])!=null?i.callbacks:void 0:void 0))return;r=[];while(Granify.events[e].callbacks.length>0)try{n=Granify.events[e].callbacks.pop(),n.callback.apply(),n.type==="repeat"&&r.push(n)}catch(s){t=s,typeof callback!="undefined"&&callback!==null&&Granify.error(t,"Event callback error: "+e+",  "+callback.toString())}return Granify.events[e].callbacks=r},Granify.on=function(e,t){var n,r;(n=Granify.events)[e]==null&&(n[e]={}),(r=Granify.events[e])["callbacks"]==null&&(r.callbacks=[]),Granify.events[e].callbacks.push({type:"once",callback:t});if(Granify.events[e].triggered)return Granify.triggerEventCallbacks(e)},Granify.onEvery=function(e,t){var n,r;return(n=Granify.events)[e]==null&&(n[e]={}),(r=Granify.events[e])["callbacks"]==null&&(r.callbacks=[]),Granify.events[e].callbacks.push({type:"repeat",callback:t})})}.call(this),function(){Granify.enabled&&(Granify.isMutexLocked=function(){return Granify.getStorage(Granify.storage.MUTEX)!=null},Granify.lockMutex=function(){return Granify.setStorage(Granify.storage.MUTEX,1)},Granify.releaseMutex=function(){return Granify.eraseStorage(Granify.storage.MUTEX)},Granify.waitForMutex=function(e){return Granify.isMutexLocked()?setTimeout(function(){return Granify.waitForMutex(e)},100):e()})}.call(this),function(){Granify.enabled&&(Granify.getParam=function(e,t,n){var r,i,s,o,u,a,f,l;t==null&&(t=null),n==null&&(n=window.location.search),Granify.isArray(n)?(s=[],n.forEach(function(e){return s.push((e.split("?")[1]||e.replace("?","")).split("&"))})):s=(n.split("?")[1]||n.replace("?","")).split("&"),o=null;for(a=0,f=s.length;a<f;a++)r=s[a],Granify.isString(r)?(l=r.split("="),i=l[0],u=l[1]):i=r[0],e===i&&(o=u||!0);return o||t},Granify.paramExists=function(e,t){return t==null&&(t=window.location.search),!!Granify.getParam(e,!1,t)})}.call(this),function(){(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;l=this,b=void 0,r=function(e,t,n){var r,i;r=t&&n||0,i=0,t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[r+i++]=c[e])});while(i<16)t[r+i++]=0;return t},i=function(e,t){var n,r;return r=t||0,n=a,n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]},o=function(e,t,n){var r,s,o,u,a,f,l,c,h,p,v,m,g;u=t&&n||0,r=t||[],e=e||{},s=e.clockseq!==null?e.clockseq:v,a=e.msecs!==null?e.msecs:(new Date).getTime(),c=e.nsecs!==null?e.nsecs:g+1,o=a-m+(c-g)/1e4,o<0&&e.clockseq===null&&(s=s+1&16383),(o<0||a>m)&&e.nsecs===null&&(c=0);if(c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");m=a,g=c,v=s,a+=122192928e5,h=((a&268435455)*1e4+c)%4294967296,r[u++]=h>>>24&255,r[u++]=h>>>16&255,r[u++]=h>>>8&255,r[u++]=h&255,p=a/4294967296*1e4&268435455,r[u++]=p>>>8&255,r[u++]=p&255,r[u++]=p>>>24&15|16,r[u++]=p>>>16&255,r[u++]=s>>>8|128,r[u++]=s&255,l=e.node||d,f=0;while(f<6)r[u+f]=l[f],f++;return t?t:i(r)},u=function(t,n,r){var s,o,u;s=n&&r||0,typeof t=="string"&&(n=t==="binary"?new e(16):null,t=null),t=t||{},u=t.random||(t.rng||b)(),u[6]=u[6]&15|64,u[8]=u[8]&63|128;if(n){o=0;while(o<16)n[s+o]=u[o],o++}return n||i(u)};if(typeof l.require=="function")try{m=l.require("crypto").randomBytes,b=m&&function(){return m(16)}}catch(E){t=E}!b&&l.crypto&&crypto.getRandomValues&&(y=new Uint8Array(16),b=function(){return crypto.getRandomValues(y),y}),b||(g=new Array(16),b=function(){var e,t;e=0,t=void 0;while(e<16)(e&3)===0&&(t=Math.random()*4294967296),g[e]=t>>>(e&3)<<3&255,e++;return g}),e=typeof l.Buffer=="function"?l.Buffer:Array,a=[],c={},n=0;while(n<256)a[n]=(n+256).toString(16).substr(1),c[a[n]]=n,n++;w=b(),d=[w[0]|1,w[1],w[2],w[3],w[4],w[5]],f=(w[6]<<8|w[7])&16383,h=0,p=0,s=u,s.v1=o,s.v4=u,s.parse=r,s.unparse=i,s.BufferClass=e,v=l.uuid,s.noConflict=function(){return l.uuid=v,s},l.uuid=s}).call(Granify)}.call(this),function(){var e;Granify.enabled&&(e=function(){function e(){this.start()}return e.prototype.start=function(){},e.prototype.stop=function(){},e.prototype.reset=function(){},e.prototype.getData=function(){return{}},e}(),Granify.Tracker=e)}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(e=function(e){function p(){return t=p.__super__.constructor.apply(this,arguments),t}var n,s,o,u,a,f,l,c,h=this;return r(p,e),p.prototype.start=function(){var e,t,n,r,i,s,o;try{e=this,this.reset(),Granify.lastBlockTrack=new Date,is_ie8?r=GLOBAL.document:r=GLOBAL,addGranifyListener(GLOBAL.document,"mousemove",c),o=["mouseover","mouseout","mouseup","click"];for(i=0,s=o.length;i<s;i++)n=o[i],addGranifyListener(r,n,a);return addGranifyListener(GLOBAL,"scroll",l),addGranifyListener(GLOBAL,"copy",f)}catch(u){return t=u,Granify.error(t,"mouseTracker-start")}},l=Granify.throttle(function(){var e,t,n,r;if(Granify.stopped||GLOBAL.document.body==null)return;return t=((n=GLOBAL.document)!=null?(r=n.documentElement)!=null?r.scrollTop:void 0:void 0)||GLOBAL.document.body.scrollTop,Granify.scroll_distance+=Math.abs(Granify.prev_scroll_top-t),Granify.prev_scroll_top=t,e=(t+GLOBAL.innerHeight)/Granify.getDocumentHeight()*100,e=Granify.round(e),Granify.scroll_depth=e>Granify.scroll_depth?e:Granify.scroll_depth,Granify.idle_time=0,Granify.lastScroll=new Date},100),c=function(e){var t;if(Granify.stopped)return;t=e||GLOBAL.event;if(is_ie8&&typeof e.clientX=="unknown")return;try{return n(),o(e.pageX||e.clientX,e.pageY||e.clientY)}catch(r){return e=r,Granify.error(e,"getMouseStats")}},o=Granify.throttle(function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;a=e-Granify.prev_mouse_pos.x,f=t-Granify.prev_mouse_pos.y,Granify.mouse_distance+=Math.sqrt(a*a+f*f),Granify.prev_mouse_pos.y?n=Math.abs(t-Granify.prev_mouse_pos.y):n=0,l=Granify.getDocumentWidth()/2,s=Math.floor(Math.abs(l-e)/50),o=Math.floor(t/50),e<l?i="L":i="R",r=i+s.toString()+"x"+o.toString(),Granify.mouse_heatmap[r]==null&&(Granify.mouse_heatmap[r]={},Granify.mouse_heatmap[r].t=0,Granify.mouse_heatmap[r].d=0,Granify.mouse_heatmap[r].c=0),u=Math.sqrt(a*a+f*f),c=u*10,n=(c-Granify.prev_mouse_pos.s)/10,isNaN(c)&&(c=0),isNaN(n)&&(n=0),Granify.mouse_heatmap[r].d+=u,Granify.mouse_heatmap[r].s=c,Granify.mouse_heatmap[r].a=n,Granify.prev_mouse_pos={x:e,y:t,s:Granify.mouse_heatmap[r].s,a:Granify.mouse_heatmap[r].a,block:r},Granify.idle_time=0;if(GLOBAL.document.body){Granify.scrollTop=GLOBAL.document.body.scrollTop||GLOBAL.document.documentElement.scrollTop,h=l-350,p=50;if(e<h&&t-Granify.scrollTop<p)return Granify.mouse_heatmap[r].e=1}},100),a=function(e){var t,n,r,i,o;if(Granify.stopped)return;t=e||GLOBAL.event,n=e.type,r=e.target||e.srcElement,i=e.pageX||e.clientX,o=e.pageY||e.clientY;try{return s(n,r,i,o)}catch(u){return e=u,Granify.error(e,"mouse_context")}},s=Granify.throttle(function(e,t,n,r){var s,o,a,f,l,c,h,p;n==null&&(n=0),r==null&&(r=0),l=["B","P","STRONG","DIV","SPAN","I","EM","LI"],f=t.tagName;switch(e){case"click":c="click",s=1;break;case"mouseover":Granify.event_start_time=(new Date).getTime(),c="over",s=1;break;case"mouseout":c="time",Granify.event_start_time?s=((new Date).getTime()-Granify.event_start_time)/1e3:s=0;break;default:c="selection"}c==="selection"&&GLOBAL.getSelection!=null&&u()!==""&&(Granify.mouse_stats.selections+=1);if(c==="click"){a={},a.path=Granify.createXPathFromElement(t),a.id=t.id,a.class_name=t.className,a.time=Granify.round((new Date).getTime()/1e3),a.x=parseInt(n),a.y=parseInt(r);if(f==="A"||f==="BUTTON"||f==="INPUT"&&(t.type.toUpperCase()==="SUBMIT"||t.type.toUpperCase()==="BUTTON"))a.text=t.innerText;Granify.mouse_stats.clicks.push(a),o=Granify.prev_mouse_pos.block,o&&o!==""&&Granify.mouse_heatmap&&Granify.mouse_heatmap[o]&&((h=Granify.mouse_heatmap[o]).c==null&&(h.c=0),Granify.mouse_heatmap[o].c+=1)}if(typeof Granify!="undefined"&&Granify!==null?!Granify.mouse_stats:!void 0)Granify.mouse_stats={};return Granify.mouse_stats[c]||(Granify.mouse_stats[c]={links:0,text:0,images:0,buttons:0,other:0}),f==="A"?Granify.mouse_stats[c].links+=s:i.call(l,f)>=0&&((p=t.children)!=null?p.length:void 0)===0&&t.innerText!==""?Granify.mouse_stats[c].text+=s:f==="IMG"?Granify.mouse_stats[c].images+=s:f==="BUTTON"||f==="INPUT"&&(t.type.toUpperCase()==="SUBMIT"||t.type.toUpperCase()==="BUTTON")?Granify.mouse_stats[c].buttons+=s:Granify.mouse_stats[c].other+=s},100),n=function(){var e,t,n,r,i;return i=Granify.getDocumentWidth()/2,n=Math.floor(Math.abs(i-Granify.prev_mouse_pos.x)/50),r=Math.floor(Granify.prev_mouse_pos.y/50),Granify.prev_mouse_pos.x<i?t="L":t="R",e=t+n.toString()+"x"+r.toString(),Granify.mouse_heatmap[e]==null&&(Granify.mouse_heatmap[e]={},Granify.mouse_heatmap[e].t=0,Granify.mouse_heatmap[e].d=0),Granify.tracking_stopped||(Granify.mouse_heatmap[e].t+=(new Date-Granify.lastBlockTrack)/1e3),Granify.lastBlockTrack=new Date},u=function(){var e,t,n,r,i,s;try{n="";if(GLOBAL.getSelection!=null){s=GLOBAL.getSelection();if(s.rangeCount){e=GLOBAL.document.createElement("div"),r=0,i=s.rangeCount;while(r<i)e.appendChild(s.getRangeAt(r).cloneContents()),++r;n=e.innerHTML}}else GLOBAL.document.selection!=null&&GLOBAL.document.selection.type==="Text"&&(n=GLOBAL.document.selection.createRange().htmlText);return n}catch(o){return t=o,""}},f=function(e){var t;if(Granify.stopped)return;try{if(GLOBAL.document.getSelection)return t={text:GLOBAL.document.getSelection().toString().replace(/[\"\\\']/gi,"").substring(0,140),orig_length:GLOBAL.document.getSelection().toString().length},Granify.mouse_stats.copied_text.push(t)}catch(n){return e=n,Granify.error(e,"getMouseCopy")}},p.prototype.stop=function(){var e,t,n,r,i,s;try{is_ie8?n=GLOBAL.document:n=GLOBAL,removeGranifyListener(GLOBAL.document,"mousemove",this.handleStats),s=["mouseover","mouseout","mouseup","click"];for(r=0,i=s.length;r<i;r++)t=s[r],removeGranifyListener(n,t,this.handleMouseContext);return removeGranifyListener(GLOBAL,"scroll",this.handleScroll),removeGranifyListener(GLOBAL,"copy",this.handleMouseCopy)}catch(o){return e=o,Granify.error(e,"mouseTracker-stop")}},p.prototype.reset=function(){var e,t,n,r,i,s,o,u,a,f,l,c;Granify.scroll_distance=0,Granify.scroll_depth=0,Granify.prev_scroll_top=0,Granify.mouse_distance=0,Granify.prev_mouse_pos={x:0,y:0,s:(o=typeof Granify!=="undefined"&&Granify!==null?(u=Granify.prev_mouse_pos)!=null?u.s:void 0:void 0)!=null?o:0,a:(a=typeof Granify!=="undefined"&&Granify!==null?(f=Granify.prev_mouse_pos)!=null?f.a:void 0:void 0)!=null?a:0},Granify.mouse_heatmap={},Granify.mouse_stats={},Granify.mouse_stats.selections=0,l=["over","click","time"];for(n=0,i=l.length;n<i;n++){t=l[n],Granify.mouse_stats[t]={},c=["text","links","images","buttons","other"];for(r=0,s=c.length;r<s;r++)e=c[r],Granify.mouse_stats[t][e]=0}return Granify.mouse_stats.copied_text=[],Granify.mouse_stats.clicks=[]},p.prototype.getData=function(){var e,t,n,r,i,s,o;try{return t={mouse_distance:Granify.mouse_distance!=null?Granify.round(Granify.mouse_distance):0,scroll_distance:(n=Granify.scroll_distance)!=null?n:0,scroll_depth:(r=Granify.scroll_depth)!=null?r:0,mouse_heatmap:(i=JSON.stringify(Granify.compact_object(Granify.reduce_precision(Granify.mouse_heatmap))))!=null?i:"{}",mouse_stats:(s=JSON.stringify(Granify.compact_object(Granify.reduce_ms_precision(Granify.mouse_stats))))!=null?s:"{}",scroll_top:(o=Granify.prev_scroll_top)!=null?o:0},Granify.mouse_heatmap={},Granify.mouse_stats.clicks=[],t}catch(u){return e=u,Granify.error(e,"mouseTracker-getData"),{}}},p}.call(this,Granify.Tracker),Granify.tracker_classes.push(e))}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};Granify.enabled&&(e=function(e){function i(){return t=i.__super__.constructor.apply(this,arguments),t}var n;return r(i,e),i.prototype.start=function(){var e;try{return addGranifyListener(GLOBAL,"keyup",n)}catch(t){return e=t,Granify.error(e,"keyboardTracker-start")}},n=Granify.throttle(function(){return Granify.idle_time=0},100),i.prototype.stop=function(){var e;try{return removeGranifyListener(GLOBAL,"keyup",n)}catch(t){return e=t,Granify.error(e,"keyboardTracker-stop")}},i}(Granify.Tracker))}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};Granify.enabled&&(e=function(e){function r(){return this.handler=n(this.handler,this),t=r.__super__.constructor.apply(this,arguments),t}return i(r,e),r.prototype.start=function(){var e;try{return this.reset(),GLOBAL.document.hidden!=null?(this.hidden="hidden",this.visibilityChange="visibilitychange"):GLOBAL.document.mozHidden!=null?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):GLOBAL.document.msHidden!=null?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):GLOBAL.document.webkitHidden!=null&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),addGranifyListener(GLOBAL.document,this.visibilityChange,this.handler)}catch(t){return e=t,Granify.error(e,"browserTracker-start")}},r.prototype.handler=function(){var e;try{if(Granify.stopped)return;return GLOBAL.document[this.hidden]?(Granify.tab_changes+=1,Granify.page_visit+=((new Date).getTime()-Granify.start_time)/1e3):Granify.start_time=(new Date).getTime()}catch(t){return e=t,Granify.error(e,"handleVisibilityChange")}},r.prototype.stop=function(){var e;try{return removeGranifyListener(GLOBAL.document,this.visibilityChange,this.handler)}catch(t){return e=t,Granify.error(e,"browserTracker-stop")}},r.prototype.getReferrer=function(){var e,t,n;if(((n=GLOBAL.document)!=null?n.referrer:void 0)==null){Granify.log_error("Unable to determine referrer, GLOBAL.document.referrer is falsey");return}try{e=decodeURI(GLOBAL.document.referrer)}catch(r){t=r,e=decodeURI(unescape(GLOBAL.document.referrer).replace(/%/g,"")).replace(/(http|https):\/\//,"")}return e.replace(/(http|https):\/\//,"")},r.prototype.getData=function(){var e,t,n;try{return Granify.referrer==null&&(Granify.referrer=this.getReferrer()),GLOBAL.location.origin||(GLOBAL.location.origin=GLOBAL.location.protocol+"//"+GLOBAL.location.hostname+(GLOBAL.location.port?":"+GLOBAL.location.port:"")),t=GLOBAL.location.toString().replace(GLOBAL.location.origin,""),{tab_changes:(n=Granify.tab_changes)!=null?n:0,viewport:JSON.stringify({h:Math.max(GLOBAL.document.documentElement.clientHeight,GLOBAL.innerHeight||0),w:Math.max(GLOBAL.document.documentElement.clientWidth,GLOBAL.innerWidth||0)}),timezone:Granify.getTimezone(),referer:Granify.referrer,path:t}}catch(r){return e=r,Granify.error(e,"browserTracker-getData")}},r.prototype.reset=function(){return Granify.tab_changes=0},r}(Granify.Tracker),Granify.tracker_classes.push(e))}.call(this),function(){Granify.enabled&&(Granify.setData=function(e,t){return Granify.data||(Granify.data={}),Granify.data[e]=t},Granify.time_since=function(e){return((new Date).getTime()-e)/1e3})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(Granify.getGaAttributes=function(){var e,t,n,r,i,s,o,u,a,f,l;try{s=new RegExp("(?:^|\\W)__utmz=([^;]*)","g"),r=s.exec(GLOBAL.document.cookie),r&&(u=decodeURI(r[1]));if(u!=null&&u.length>0){t={},l=u.split(".").slice(4).join(".").split("|");for(a=0,f=l.length;a<f;a++)i=l[a],o=i.split("="),t[o[0]]=o[1],t[o[0]]!=null&&(t[o[0]]=t[o[0]].replace(/\(/,""),t[o[0]]=t[o[0]].replace(/\)/,""));return n={},t.utmcmd!=null&&(n.medium=t.utmcmd),t.utmcsr!=null&&(n.source=t.utmcsr),t.utmcct!=null&&(n.content=t.utmcct.replace(/\t|\r|\n/gm,"")),t.utmccn!=null&&(n.campaign=t.utmccn),t.utmctr!=null&&(n.term=t.utmctr.replace(/\t|\r|\n/gm,"")),n}return{}}catch(c){e=c}return Granify.error(e,"getGaAttributes")},Granify.shouldTrackGa=function(){return Granify.analyticsID.length>0},Granify.loadGaTracking=function(){var e,t,n,r,i,s,o,u;if(typeof granifyGA!="undefined"&&granifyGA!==null||!Granify.shouldTrackGa())return;e=GLOBAL.GoogleAnalyticsObject,e&&GLOBAL[e]&&Granify.isFunction(GLOBAL[e])?window.granifyGA=GLOBAL[e]:function(e,t,n,r,i,s,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=t.createElement(n),o=t.getElementsByTagName(n)[0],s.async=1,s.src=r,o.parentNode.insertBefore(s,o)}(window,document,"script","//www.google-analytics.com/analytics.js","granifyGA"),o=Granify.analyticsID,u=[];for(t=i=0,s=o.length;i<s;t=++i)n=o[t],r={cookieDomain:GLOBAL.location.host,cookieName:"_granifyGA_"+t,name:"granifyTracker"+t},Granify.shouldTrackGaOnServerSide()&&(r.userId=Granify.UUID,r.clientId=Granify.UUID),u.push(granifyGA("create",n[0],r));return u},Granify.trackGaEvent=function(e,t,n){var r,i,s,o,u,a,f,l,c;if(!Granify.shouldTrackGa())return;(typeof granifyGA=="undefined"||granifyGA===null)&&Granify.loadGaTracking(),l=Granify.analyticsID,c=[];for(r=a=0,f=l.length;a<f;r=++a){u=l[r],s=u[1],i=u[2];if(e==="customer"&&!i)continue;if(e==="message"&&t==="control-group"&&!s)continue;o={},u[4]&&(o.nonInteraction=1),c.push(granifyGA("granifyTracker"+r+".send","event",e,t,n,o))}return c},Granify.sendGaGroup=function(e){return Granify.getSharedData(Granify.storage.GA_GROUP).then(function(t){if(!t)return Granify.trackGaEvent("customer","group",e),Granify.setSharedData(Granify.storage.GA_GROUP,"1")})},Granify.sendGaOrder=function(e){var t,n,r,i,s,o,u,a,f,l,c;if(!Granify.shouldTrackGa())return;(typeof granifyGA=="undefined"||granifyGA===null)&&Granify.loadGaTracking(),r=(e.total_price||0)-(e.subtotal_price||0)-(e.total_tax||0),r<0&&(r=0),f=Granify.analyticsID,c=[];for(t=s=0,u=f.length;s<u;t=++s){i=f[t];if(!i[3])continue;granifyGA("granifyTracker"+t+".require","ecommerce","ecommerce.js"),granifyGA("granifyTracker"+t+".ecommerce:addTransaction",{id:String(e.order_number),affiliation:String(Granify.SHOP_ID),revenue:String(e.subtotal_price||0),shipping:String(r),tax:String(e.total_tax||0),currency:e.currency||"USD"});if(e.line_items){l=e.line_items;for(o=0,a=l.length;o<a;o++)n=l[o],granifyGA("granifyTracker"+t+".ecommerce:addItem",{id:String(e.order_number),name:String(n.name),sku:String(n.product_id),category:"General",price:String(n.price||0),quantity:String(n.quantity||0),currency:e.currency||"USD"})}c.push(granifyGA("granifyTracker"+t+".ecommerce:send"))}return c},Granify.on("offer:shown",function(){var e;e=Granify.old_offer,console.log("trackGaEvent offer:shown "+e.id+":"+e.outcome.headline);if(Granify.previewMode||Granify.previewModeWithMatching)return;return Granify.trackGaEvent("message","shown",""+e.id+":"+e.outcome.headline)}),Granify.on("control_group",function(){return Granify.getSharedData(Granify.storage.GA_CONTROL_GROUP).then(function(e){if(!e)return Granify.trackGaEvent("message","control-group","not-shown"),Granify.setSharedData(Granify.storage.GA_CONTROL_GROUP,"1")})}),Granify.shouldTrackGaOnServerSide=function(){var t;return Granify.shouldTrackGa()?(t=Number(Granify.SHOP_ID),e.call(Granify.rb.server_ga_stores,t)>=0):!1})}.call(this),function(){Granify.initCoupon=function(e){return Granify.savedCallback=e,Granify.use_local_jquery&&GLOBAL.jQuery?(Granify.JQ=GLOBAL.jQuery,Granify.savedCallback()):Granify.insertScript("https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js",function(){return Granify.JQ=GLOBAL.jQuery.noConflict(!0),Granify.savedCallback()})}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(Granify.checkOrderParameters=function(e){var t;return t=new Granify.Promise(function(t){e.client_order_date=parseInt(+(new Date).getTime()/1e3);if(Granify.localStorageWorking)return Granify.getSharedData(Granify.storage.LAST_SERVER_TIME).then(function(t){return t!=null&&t.time!=null&&Granify.SESSION!=null&&t.session===Granify.SESSION&&(e.order_date=t.time),Granify.pageType="receipt",e.site_id=Granify.SHOP_ID,Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.UUID)}).then(function(t){return e.uuid=Granify.UUID||t,Granify.shouldTrackGaOnServerSide()&&(e.track_ga=!0),e["financial_status"]==null&&(e.financial_status="paid"),e.financial_status=e.financial_status.toLowerCase(),(e!=null?e.subtotal_price:void 0)!=null&&e["total_line_items_price"]==null&&(e.total_line_items_price=e.subtotal_price),Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.SESSION)}).then(function(n){var r,i,s,o,u,a,f,l;e.session=Granify.SESSION||n,e.method="post",f=["currency","subtotal_price","order_number"];for(s=0,u=f.length;s<u;s++){r=f[s];if(!(e[r]!=null&&e[r].toString().length>0)){Granify.log_error(r+" is required !",e),e=null;break}}e["items"]!=null&&e["line_items"]==null&&(e.line_items=e.items,delete e.items);if(e["line_items"]!=null){l=e.line_items;for(o=0,a=l.length;o<a;o++){i=l[o],i.product_id==null&&(i.product_id=i.id);if(!(i.product_id!=null&&i.product_id.toString().length>0)){Granify.log_error("product_id is required !",e),e=null;break}i.variant_id!=null&&i.variant_id.toString().length>0||(i.variant_id="null")}}return t(e)})}),t},Granify.trackOrder=function(e,t){var n;return t==null&&(t=!1),t?(n={},Granify.checkOrderParameters(e).then(function(e){if(e)return Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.LAST_FAST_ORDER)}).then(function(t){return!e.order_number||t===e.order_number?Granify.Promise.reject():(Granify.localStorageWorking&&Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(t){var n;return n=t||[],n.push(e),Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,n),Granify.hasUnconfirmedOrders=!0}),n.site_id=Granify.SHOP_ID,Granify.Promise.resolve(e))}).then(function(){return Granify.getSharedData(Granify.storage.UUID)}).then(function(t){return n.uuid=Granify.UUID||t,Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.SESSION)}).then(function(t){var r,i;return n.session=Granify.SESSION||t,n.order_number=e.order_number,n.subtotal_price=e.subtotal_price,n.total_price=e.total_price,n.currency=e.currency,n.item_count=((i=e["line_items"])!=null?i.length:void 0)||0,n.method="jsonp",Granify.shouldTrackGaOnServerSide()&&(n.track_ga=!0),n.stopped=Granify.stopped,r=""+Granify.matching+"/javascript/orders/fast-update",Granify.JSONP(r,n,function(e){if(e.error!=null)return Granify.JSONP(r,n,function(e){})}),Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.LAST_ORDER)}).then(function(t){return Granify.SESSION_INITIALIZED===1&&!n.track_ga&&t!==e.order_number&&(Granify.sendGaOrder(n),Granify.setSharedData(Granify.storage.LAST_GA_FAST_ORDER,n.order_number)),Granify.setSharedData(Granify.storage.LAST_FAST_ORDER,n.order_number)})["catch"](function(){})):Granify.reloadFlags(function(){var t;try{return Granify.getSharedData(Granify.storage.LAST_ORDER).then(function(t){return!e.order_number||t===e.order_number?Granify.Promise.reject():Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.LAST_FAST_ORDER)}).then(function(t){return t!==e.order_number&&Granify.trackOrder(e,!0),Granify.Promise.resolve(e)}).then(function(){return Granify.checkOrderParameters(e)}).then(function(e){var t;return e?(e.stopped=Granify.stopped,t=""+Granify.matching+"/javascript/orders/update",Granify.POST(t,e,function(){return Granify.getSharedData(Granify.storage.LAST_ORDER).then(function(e){return Granify.removeUnconfirmedOrder(e)})},function(){return Granify.POST(t,e,function(){return Granify.getSharedData(Granify.storage.LAST_ORDER).then(function(e){return Granify.removeUnconfirmedOrder(e)})})}),Granify
.getSharedData(Granify.storage.LAST_GA_FAST_ORDER).then(function(t){if(t!==e.order_number&&Granify.SESSION_INITIALIZED===1&&!e.track_ga)return Granify.sendGaOrder(e)}),Granify.setSharedData(Granify.storage.LAST_ORDER,e.order_number),Granify.setHasOrders(),Granify.trackCart(!1)):Granify.Promise.reject()})["catch"](function(){})}catch(n){return t=n,Granify.error(t,"trackOrder")}})},Granify.setHasOrders=function(){return Granify.getSharedData(Granify.storage.HAS_ORDERS,function(e){if(e!=="1")return Granify.setSharedData(Granify.storage.HAS_ORDERS,"1")}),Granify.addFlag(Granify.F_IS_RETURNED_BUYER)},Granify.removeUnconfirmedOrder=function(e){if(!Granify.localStorageWorking)return;return Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(t){var n,r,i,s,o;i=t||[];for(n=s=0,o=i.length;s<o;n=++s){r=i[n];if(r.order_number===e){i.splice(n,1);break}}return i.length===0&&(Granify.hasUnconfirmedOrders=!1),Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,i)})},Granify.resendUnconfirmedOrders=function(t){var n,r;if(!Granify.localStorageWorking)return;return n=t!=null?JSON.parse(t):[],r=[],Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(t){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;c=t||[];for(p=0,m=c.length;p<m;p++)o=c[p],(b=o.order_number,e.call(function(){var e,t,n;n=[];for(e=0,t=r.length;e<t;e++)o=r[e],n.push(o.order_number);return n}(),b)<0)&&r.push(o);f=!1,l=[],s=4,h=11;if(r!=null&&r.length>0){for(i=d=0,g=r.length;d<g;i=++d)o=r[i],o["resent_tries"]==null&&(o.resent_tries=0),(w=o.order_number,e.call(n,w)>=0)||o.resent_tries>s?(l.push(i),f=!0):(o.last_resent_date?u=(+(new Date)-o.last_resent_date)/1e3:u=(+(new Date)-o.client_order_date)/1e3,a=h+(o.resent_tries+1)*3*3,u>a&&(f=!0,o.last_resent_date=+(new Date),o.resent_tries=o.resent_tries+1,o["order_date"]==null&&(o.order_date=parseInt(o.client_order_date)-Granify.clientTimeOffset),o["uuid"]==null&&Granify.getSharedData(Granify.storage.UUID).then(function(e){return Granify.UUID||e}),o["session"]==null&&Granify.getSharedData(Granify.storage.SESSION).then(function(e){return Granify.SESSION||e}),Granify.POST(""+Granify.matching+"/javascript/orders/update",o)));for(v=0,y=l.length;v<y;v++)i=l[v],r.splice(i,1);(f||r.length!==c.length)&&Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,r);if(r.length===0)return Granify.hasUnconfirmedOrders=!1}})})}.call(this),function(){Granify.enabled&&(Granify.setCartTracked=function(){return Granify._granifySendCart=null},Granify.trackCart=function(e){var t,n,r,i,s,o,u;Granify.isBoolean(e)&&e===!1&&(e={items:[]});if(!Granify.isObject(e)||!Granify.isArray(e.items)){Granify.error({name:"Cart_error",message:"trackCart called with invalid parameter: "+JSON.stringify(e)});return}t=[],n=!0,u=e.items;for(s=0,o=u.length;s<o;s++){r=u[s];if(r==null)continue;Granify.isString(r.price)&&parseFloat(r.price)==r.price&&(r.price=parseFloat(r.price)),Granify.isString(r.quantity)&&parseFloat(r.quantity)==r.quantity&&(r.quantity=parseFloat(r.quantity)),r.id==null?(Granify.error({name:"Cart_error",message:"item.id not found: "+JSON.stringify(r)},"match"),n=!1):Granify.isString(r.title)?Granify.isNumber(r.price)&&r.price>=0?Granify.isNumber(r.quantity)&&Granify.isInteger(r.quantity)&&r.quantity>=0?(i={id:r.id,title:r.title,price:r.price,quantity:r.quantity},r.image!=null&&(i.image=r.image),t.push(i)):(Granify.error({name:"Cart_error",message:"item.quantity is invalid: "+JSON.stringify(r)},"match"),n=!1):(Granify.error({name:"Cart_error",message:"item.price is invalid: "+JSON.stringify(r)},"match"),n=!1):(Granify.error({name:"Cart_error",message:"item.title is invalid: "+JSON.stringify(r)},"match"),n=!1)}if(n){Granify._granifySendCart={items:t};if(Granify.isNumber(e.price))return Granify._granifySendCart.total=e.price}})}.call(this),function(){Granify.enabled&&(Granify.trackPageView=function(e){var t;Granify.testDebug("Execute Granify.trackPageView("+JSON.stringify(e)+")"),e.page_type!=null?(e.page_type=e.page_type.replace(/[^A-Za-z]/g,""),e.page_type!=="other"&&(Granify.pageType=e.page_type)):Granify.log_error("Granify.trackPageView require page_type");if(e.product==null&&e.category==null&&e.subcategory==null)return;return t={},e.category!=null&&(t.c=e.category),e.subcategory!=null&&(t.sc=e.subcategory),e.product!=null&&(t.p=Granify.compact_object(e.product)),Granify.PAGE_META=t},Granify.checkPageType=function(){Granify.pageType==null&&(Granify.pageType=Granify.getPageType()),Granify.pageType==null&&(Granify.pageType=Granify.page_type);if(Granify.pageType==="receipt")return Granify.setHasOrders()})}.call(this),function(){Granify.enabled&&(Granify.identify=function(e){return Granify.reloadFlags(function(){var t;try{return e.site_id=Granify.SHOP_ID,e.uuid=Granify.UUID,e.session=Granify.SESSION,Granify.POST(""+Granify.matching+"/javascript/users/identify",e)}catch(n){return t=n,Granify.error(t,"identify"),!1}})})}.call(this),function(){Granify.enabled&&(Granify.FLAGS=null,Granify.tracking_stopped=!1,Granify.tracking_initialized=!1,Granify.campaign=null,Granify.old_offer=null,Granify.group="unknown",Granify.matching=Granify.rb.matching_host,Granify.test_mode=!1,Granify.rb.environment("test")&&(Granify.test_mode=!0),Granify.tracking_wait_interval=1e3,Granify.matching_requests=[],Granify.keyname=function(e,t){var n;return t==null&&(t=!1),n="."+Granify.SHOP_ID,e==="uuid"&&(n=""),e==="uuid"?"granify.uuid":"granify."+e+n},Granify.version=Granify.rb.version,Granify.getSharedData(Granify.storage.THROW_ERRORS).then(function(e){if(e)return Granify.throw_errors=!0}),Granify.errors=[],Granify.testsDebugMessages=[],Granify.hasUnconfirmedOrders=!1,Granify.latency={},Granify.latency.mutex=!1,Granify.match_timeout=null,Granify.resetSources=[],Granify.rb.get_analytics(),Granify.start=function(){return addGranifyListener(GLOBAL,"beforeunload",function(){var e;try{Granify.stop()}catch(t){e=t}}),Granify.testDebug("Execute Granify.start()"),Granify.isMutexLocked()||(Granify.lockMutex(),Granify.acquiredMutex=!0),setTimeout(function(){var e,t,n,r,i;Granify._stack==null&&(Granify._stack=[]),r=Granify._stack,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e[0]==="trackOrder"?i.push(Granify[e[0]](e[1],!0)):i.push(void 0);return i},0),Granify.reset("start"),Granify.idle_watch=setInterval(function(){return Granify.testDebug("Execute Granify.idle_watch"),Granify.idle_tracking()},1e3),setTimeout(function(){return Granify.acquiredMutex?(Granify.testDebug("Mutex aquired!"),Granify.onPageLoad()):(Granify.testDebug("Mutex not aquired!"),Granify.waitForMutex(function(){return Granify.onPageLoad()}))},0)},Granify.onPageLoad=function(){return GLOBAL.document.readyState==="complete"||Granify.is_ie&&GLOBAL.document.readyState==="interactive"?Granify.init():(Granify.is_ie&&addGranifyListener(GLOBAL,"DOMContentLoaded",Granify.init),addGranifyListener(GLOBAL,"load",Granify.init))},Granify.init=function(){var e,t,n,r,i,s;if(this.wasInitialized)return;this.wasInitialized=!0,Granify.init_time=+(new Date),s=Granify.tracker_classes;for(r=0,i=s.length;r<i;r++)e=s[r],Granify.trackers.push(new e);Granify.use_iframe&&Granify.insertFrame(),Granify.reloadFlags(function(){return Granify.acquiredMutex&&Granify.releaseMutex(),Granify.initializeMatching()}),Granify.trigger("granify:init");try{t=Granify.getStorage(Granify.storage.BOOKMARKLET),Granify.paramExists("granify_preview",[location.href,GLOBAL.document.referrer])&&(Granify.previewMode=!0);if(t==="open"||Granify.previewMode)return Granify.insertScript(""+Granify.domain+"/install-bookmarklet.js",function(){},"granify-bookmarklet-script")}catch(o){n=o}},Granify.initializeMatching=function(){var e,t;Granify.testDebug("Execute Granify.initializeMatching()"),Granify._stack!=null&&Granify._stack.length>0&&(Granify.is_js_api=!0),Granify._stack==null&&(Granify._stack=[]);while(e=Granify._stack.shift())t=e.shift(),Granify[t].apply(null,e);return typeof Granify.platformSpecificCode=="function"&&Granify.platformSpecificCode(),Granify.match()},Granify.stop=function(){var e,t,n,r;Granify.stopped=!0,Granify.tracking_stopped=!0,r=Granify.trackers;for(t=0,n=r.length;t<n;t++)e=r[t],e.stop();return Granify.trackers=[]},Granify.resetLocal=function(){var e,t,n,r,i;Granify.testDebug("Executing Granify.resetLocal: "+arguments.callee.caller.toString()),Granify.page_visit=0,Granify.start_time=+(new Date),Granify.start_time_fixed=Granify.start_time,Granify.cumulated_active_time=0,Granify.mouse_activity_resumed_date=Granify.start_time_fixed,Granify.mouse_active_time_total=0,Granify.idle_time=0,Granify.current_time=null,r=Granify.trackers;for(t=0,n=r.length;t<n;t++)e=r[t],e.reset();return Granify.eraseSharedData(Granify.storage.ENTRY_PAGE_SENT),Granify.eraseSharedData(Granify.storage.ENTRY_REFERRER_SENT),Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(e){if(e!=null&&e!==""&&e.length!==0)return Granify.hasUnconfirmedOrders=!0}),(i=Granify.current_coupon)!=null&&typeof i.hide=="function"&&i.hide(),Granify.latestSentData=null},Granify.reset=function(e){return e==null&&(e="unknown"),Granify.testDebug("Executing Granify.reset: "+arguments.callee.caller.toString()+")"),Granify.resetSources.length<10&&Granify.resetSources.push(e),Granify.resetLocal(),Granify.data=null,Granify.tags=[],Granify.location=GLOBAL.location.href,Granify.pageType=null},Granify.track=Granify.throttle(function(){var e,t;Granify.testDebug("Execute Granify.track()"),t=(new Date).getTime(),Granify.page_visit+=(t-Granify.start_time)/1e3,Granify.start_time=t;try{Granify.reloadFlags(function(){return Granify.platformSpecificCode(),Granify.match()})}catch(n){e=n,Granify.error(e,"match")}return!0},100),Granify.scheduleNextMatch=function(){Granify.testDebug("Execute Granify.scheduleNextMatch()");if(!Granify.tracking_stopped)return setTimeout(function(){return Granify.track()},Granify.tracking_wait_interval)},Granify.idle_tracking=Granify.throttle(function(){Granify.testDebug("Execute Granify.idle_tracking()"),Granify.idle_time+=1;if(Granify.stopped)return;Granify.idle_time>5&&!Granify.tracking_stopped?(Granify.tracking_stopped=!0,Granify.cumulated_active_time+=Granify.time_since(Granify.mouse_activity_resumed_date)):Granify.tracking_stopped&&Granify.idle_time<=5&&(Granify.tracking_stopped=!1,Granify.mouse_activity_resumed_date=+(new Date),Granify.scheduleNextMatch());if(!Granify.tracking_stopped)return Granify.mouse_active_time_total=Granify.cumulated_active_time+Granify.time_since(Granify.mouse_activity_resumed_date)},100),Granify.handleOffer=function(e,t){var n;t==null&&(t=null);if(Granify.stopped)return;try{if((e!=null?e.tg:void 0)==null)return Granify.SESSION_INITIALIZED=2,Granify.setSharedData(Granify.storage.SESSION_INITIALIZED,+Granify.SESSION_INITIALIZED,Granify.session_expiration()),Granify.stop(),!1;Granify.SESSION_INITIALIZED=1,Granify.setSharedData(Granify.storage.SESSION_INITIALIZED,+Granify.SESSION_INITIALIZED,Granify.session_expiration()),Granify.addFlag(Granify.F_FLAGS_INITIALIZED),e.tg?(Granify.trigger("test_group"),Granify.sendGaGroup("baseline"),Granify.addFlag(Granify.F_TEST_GROUP),Granify.group="baseline"):(Granify.sendGaGroup("granify"),Granify.removeFlag(Granify.F_TEST_GROUP),Granify.trigger("granify_group"),Granify.group="granify"),e.debug&&Granify.showDebug(e),e.rs?Granify.addFlag(Granify.F_RANDOM_SAMPLING):Granify.removeFlag(Granify.F_RANDOM_SAMPLING);if(e.cg)return Granify.addFlag(Granify.F_CG_INITIALIZED),Granify.addFlag(Granify.F_CG),Granify.trigger("control_group"),!0;if(e.campaign){Granify.addFlag(Granify.F_CG_INITIALIZED),Granify.removeFlag(Granify.F_CG);if(JSON.stringify(e.campaign)===JSON.stringify(Granify.old_offer))return Granify.updateWidget(e),!0;Granify.current_coupon&&Granify.current_coupon.remove(),Granify.campaign=e.campaign,Granify.old_offer=e.campaign,Granify.latency.mutex=!0,Granify.loadWidget(e)}return!0}catch(r){return n=r,Granify.error(n,"handleOffer"),!1}},Granify.updateWidget=function(e){var t;return t={shared_user_data:e.sud,shared_offer_data:e.sod},Granify.current_coupon&&Granify.current_coupon.loadSharedData(t),!0},Granify.loadWidget=function(e){return Granify.initCoupon(function(){var t,n,r,i,s,o;try{i=e.campaign.campaign_type;switch(i){case"discount":o=e.campaign.offer.value,t=e.campaign.offer.coupon;break;case"percent":o=e.campaign.offer.value,t=e.campaign.offer.coupon;break;case"shipping":o="",t=e.campaign.offer.coupon;break;default:o="",t=""}return r={id:e.campaign.id,type:i,headline:e.campaign.outcome.headline,message:e.campaign.outcome.text,style:e.campaign.outcome.style,locale:e.campaign.outcome.locale,amount:o,coupon:t,experiment:e.campaign.experiment,force_matching:e.force_matching,shared_user_data:e.sud,shared_offer_data:e.sod},e.custom_url!=null?s=e.custom_url:s=""+Granify.domain+"/custom_assets/widget/"+r.experiment+".js",Granify.insertScript(s,function(){return Granify.current_coupon=new Granify.widget_class(r),Granify.current_coupon.initialize(),Granify.latency.offer_shown=+(new Date)})}catch(u){return n=u,Granify.error(n,"loadWidget"),!1}})},Granify.touchSession=function(){var e,t;return t=Granify.session_expiration(),Granify.setSharedData(Granify.storage.SESSION,Granify.SESSION,t),Granify.setSharedData(Granify.storage.SESSION_INITIALIZED,Granify.SESSION_INITIALIZED,t),Granify.setSharedData(Granify.storage.FLAGS,Granify.FLAGS),e=[],e.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE)),e.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER)),Granify.Promise.all(e).then(function(e){var n,r;n=e[0],r=e[1],n&&Granify.setSharedData(Granify.storage.ENTRY_PAGE,n,t);if(r)return Granify.setSharedData(Granify.storage.ENTRY_REFERRER,r,t)})},Granify.reloadFlags=function(e){if(Granify.previewMode)return;Granify.setSharedData(Granify.storage.CHECK_IFRAME_COOKIES,"1"),Granify.getSharedData(Granify.storage.CHECK_IFRAME_COOKIES).then(function(t){var n;return t==="1"?(Granify.eraseSharedData(Granify.storage.CHECK_IFRAME_COOKIES),n=[],n.push(Granify.getSharedData(Granify.storage.UUID)),n.push(Granify.getSharedData(Granify.storage.SESSION)),n.push(Granify.getSharedData(Granify.storage.FLAGS)),n.push(Granify.getSharedData(Granify.storage.LAST_SESSION)),n.push(Granify.getSharedData(Granify.storage.HAS_ORDERS)),n.push(Granify.getSharedData(Granify.storage.SESSION_INITIALIZED)),Granify.Promise.all(n).then(function(t){var n,r,i,s,o,u,a;return a=t[0],u=t[1],n=t[2],o=t[3],r=t[4],i=t[5],a?Granify.UUID=a:Granify.use_iframe||(Granify.UUID=Granify.uuid.v4()),Granify.setSharedData(Granify.storage.UUID,Granify.UUID),s=!1,u?(Granify.SESSION=parseInt(u),s=!1):(Granify.resetLocal(),Granify.SESSION=parseInt(Granify.start_time_fixed),s=!0),n?Granify.FLAGS=parseInt(n):Granify.FLAGS=0,s&&(o!=null&&o>0?(Granify.removeFlag(Granify.F_IS_NEW_USER),Granify.addFlag(Granify.F_IS_RETURNED_USER),r==="1"&&Granify.addFlag(Granify.F_IS_RETURNED_BUYER)):Granify.addFlag(Granify.F_IS_NEW_USER),Granify.setSharedData(Granify.storage.LAST_SESSION,Granify.SESSION)),!i||s?Granify.SESSION_INITIALIZED=0:Granify.SESSION_INITIALIZED=parseInt(i),Granify.touchSession(),e()})):Granify.stop()})},Granify.addFlag=function(e){return Granify.FLAGS=Granify.FLAGS|e,Granify.setSharedData(Granify.storage.FLAGS,Granify.FLAGS)},Granify.removeFlag=function(e){if((Granify.FLAGS&e)===0)return;return Granify.FLAGS=Granify.FLAGS^e,Granify.setSharedData(Granify.storage.FLAGS,Granify.FLAGS)},Granify.match_function=function(){var e,t,n,r,i,s,o,u,a,f,l,c;if(Granify.stopped)return;Granify.testDebug("Execute Granify.match()");if(Granify.previewMode){Granify.stop();return}clearTimeout(Granify.match_timeout);if(!Granify.SHOP_ID||!Granify.UUID||!Granify.SESSION||Granify.FLAGS==null||Granify.SESSION_INITIALIZED==null){Granify.match_timeout=setTimeout(function(){return Granify.track()},100);return}if(!Granify.UUID.match(/^[0-9A-Fa-f-]+$/)){Granify.log_error("Wrong UUID format",{x:Granify.version.js,domain:Granify.cookies_domain,uuid:JSON.stringify(Granify.UUID)}),Granify.setSharedData(Granify.storage.UUID,"");return}if(Granify.lastScroll&&new Date-Granify.lastScroll<500){Granify.match_timeout=setTimeout(function(){return Granify.track()},1e3);return}Granify.isLocationChanged(Granify.location)&&Granify.reset("locationChanged"),Granify.checkPageType(),t=Granify.FLAGS,Granify.touchSession(),Granify.SESSION_INITIALIZED||(t|=Granify.F_NEW_SESSION),Granify.mouse_active_time_total!=null?i=Granify.round(Granify.mouse_active_time_total):i=0,e={uuid:Granify.UUID,session:Granify.SESSION,site_id:Granify.SHOP_ID,start_time:Granify.start_time_fixed,visit_duration:Granify.page_visit!=null?Granify.round(Granify.page_visit):0,page_type:(l=Granify.pageType)!=null?l:"other",tags:Granify.tags,flags:t,mouse_active_time:i,x:Granify.version.js},Granify._granifySendCart!=null&&(e.cart_contents=Granify._granifySendCart,Granify.setCartTracked()),c=Granify.trackers;for(a=0,f=c.length;a<f;a++){o=c[a],n=o.getData();for(r in n)u=n[r],e[r]=u}return Granify.hasUnconfirmedOrders&&(e.has_unconfirmed_orders=+Granify.hasUnconfirmedOrders),Granify.ga==null&&(Granify.ga=JSON.stringify(Granify.packObj(Granify.getGaAttributes()))),e.ga=Granify.ga,Granify.data&&(e.data=JSON.stringify(Granify.data),Granify.data=null),Granify.latency.mutex&&Granify.latency.offer_shown&&(e.widget_latency_full=Granify.latency.offer_shown-Granify.latency.last_request_sent,e.widget_latency_js=Granify.latency.offer_shown-Granify.latency.last_request_response,Granify.latency.mutex=!1,Granify.latency.offer_shown=null),s=[],s.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE)),s.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE_SENT)),s.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER)),s.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER_SENT)),Granify.Promise.all(s).then(function(n){var r,i,s,o,u,a,f;return r=n[0],i=n[1],s=n[2],o=n[3],r&&!i&&(e.entry_page=r),s&&!o&&(e.entry_referrer=s),Granify.current_time!=null?Granify.current_time=parseInt(+(new Date).getTime()/1e3):Granify.current_time=e.start_time,e!=null&&(e.current_time=Granify.current_time),Granify.timeSinceStart==null&&(typeof performance!=="undefined"&&performance!==null?(a=performance.timing)!=null?a.navigationStart:void 0:void 0)!=null&&(Granify.timeSinceStart=Granify.current_time-performance.timing.navigationStart,e.time_since_start=Granify.timeSinceStart),Granify.timeSinceDom==null&&(typeof performance!=="undefined"&&performance!==null?(f=performance.timing)!=null?f.domLoading:void 0:void 0)!=null&&(Granify.timeSinceDom=Granify.current_time-performance.timing.domLoading,e.time_since_dom=Granify.timeSinceDom),u=Granify.packObj(Granify.removeUnchangedData(e)),Granify.PAGE_META!=null&&(u.pm=JSON.stringify(Granify.PAGE_META)),Granify.latency.mutex||(Granify.latency.last_request_sent=+(new Date)),Granify.testDebug("Send data to Goliath: "+JSON.stringify(u)),Granify.POST(""+Granify.matching+"/match",u,function(n){var r;Granify.latency.mutex||(Granify.latency.last_request_response=+(new Date));if(n.error==null){n.st!=null&&n.st!==Granify.start_time_fixed&&(r=!0),Granify.testDebug("Received data from Goliath: "+JSON.stringify(n)),Granify.PAGE_META=null,Granify.latestSentData=e,e.entry_page&&Granify.setSharedData(Granify.storage.ENTRY_PAGE_SENT,"1"),e.entry_referrer&&Granify.setSharedData(Granify.storage.ENTRY_REFERRER_SENT,"1"),Granify.localStorageWorking&&n.ct&&(Granify.lastServerTime=n.ct,Granify.clientTimeOffset=parseInt(+(new Date).getTime()/1e3)-parseInt(Granify.lastServerTime),Granify.setSharedData(Granify.storage.LAST_SERVER_TIME,{time:Granify.lastServerTime,session:Granify.SESSION})),Granify.hasUnconfirmedOrders&&Granify.resendUnconfirmedOrders(n.co);if(Granify.previewModeWithMatching||r)return Granify.scheduleNextMatch();if(Granify.handleOffer(n,t))return Granify.scheduleNextMatch()}})})},Granify.match=Granify.throttle(Granify.match_function,Granify.tracking_wait_interval),Granify.testDebug("Before Granify.start()"),Granify.addErrorHandling(Granify),Granify.start())}.call(this),function(){Granify.enabled&&(Granify.send_validation_errors=!0,Granify.platformSpecificCode=function(){return Granify.page_type!=null&&(Granify.pageType=Granify.page_type),Granify.pageType==null&&(Granify.pageType="other"),Granify.is_js_api=!0},Granify.getPageType=function(){return Granify.pageType||"other"})}.call(this);


